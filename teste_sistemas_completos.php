<?php
// teste_sistemas_completos.php - Teste completo dos novos sistemas

echo "<h1>üß™ TESTE COMPLETO DOS NOVOS SISTEMAS</h1>";
echo "<hr>";

// 1. Verificar se as tabelas foram criadas
echo "<h2>1. Verifica√ß√£o de Tabelas do Banco</h2>";

try {
    require_once 'includes/db_connect.php';
    
    $tabelas = ['rotina_diaria', 'pomodoro_sessions', 'config_rotina_padrao'];
    
    foreach ($tabelas as $tabela) {
        $stmt = $pdo->query("SHOW TABLES LIKE '$tabela'");
        if ($stmt->rowCount() > 0) {
            echo "‚úÖ <strong>$tabela</strong> - Tabela existe<br>";
        } else {
            echo "‚ùå <strong>$tabela</strong> - Tabela N√ÉO existe<br>";
        }
    }
    
    // Verificar colunas adicionadas em tarefas
    $stmt = $pdo->query("SHOW COLUMNS FROM tarefas LIKE 'hora_inicio'");
    if ($stmt->rowCount() > 0) {
        echo "‚úÖ <strong>tarefas.hora_inicio</strong> - Coluna existe<br>";
    } else {
        echo "‚ùå <strong>tarefas.hora_inicio</strong> - Coluna N√ÉO existe<br>";
    }
    
    $stmt = $pdo->query("SHOW COLUMNS FROM tarefas LIKE 'tempo_gasto'");
    if ($stmt->rowCount() > 0) {
        echo "‚úÖ <strong>tarefas.tempo_gasto</strong> - Coluna existe<br>";
    } else {
        echo "‚ùå <strong>tarefas.tempo_gasto</strong> - Coluna N√ÉO existe<br>";
    }
    
} catch (PDOException $e) {
    echo "‚ùå <strong>Erro de conex√£o:</strong> " . $e->getMessage() . "<br>";
}

echo "<br>";

// 2. Verificar arquivos criados
echo "<h2>2. Verifica√ß√£o de Arquivos</h2>";

$arquivos = [
    'rotina_diaria.php' => 'P√°gina principal da rotina di√°ria',
    'pomodoro.php' => 'Sistema de pomodoro',
    'automatizacao_horario.php' => 'Automatiza√ß√£o por hor√°rio',
    'salvar_rotina_diaria.php' => 'Backend para salvar rotina',
    'adicionar_rotina_diaria.php' => 'Backend para adicionar rotina',
    'criar_sessao_pomodoro.php' => 'Backend para criar sess√£o pomodoro',
    'finalizar_sessao_pomodoro.php' => 'Backend para finalizar pomodoro',
    'buscar_historico_pomodoro.php' => 'Backend para buscar hist√≥rico',
    'cancelar_sessao_pomodoro.php' => 'Backend para cancelar pomodoro'
];

foreach ($arquivos as $arquivo => $descricao) {
    if (file_exists($arquivo)) {
        echo "‚úÖ <strong>$arquivo</strong> - $descricao<br>";
    } else {
        echo "‚ùå <strong>$arquivo</strong> - $descricao (N√ÉO encontrado)<br>";
    }
}

echo "<br>";

// 3. Verificar integra√ß√£o no dashboard
echo "<h2>3. Verifica√ß√£o de Integra√ß√£o</h2>";

if (file_exists('dashboard.php')) {
    $content = file_get_contents('dashboard.php');
    
    $checks = [
        'rotina_hoje' => 'Vari√°vel de rotina no dashboard',
        'stats_rotina' => 'Estat√≠sticas de rotina',
        'stats_pomodoro' => 'Estat√≠sticas de pomodoro',
        'toggleRotina' => 'Fun√ß√£o JavaScript para rotina',
        'startPomodoroQuick' => 'Fun√ß√£o JavaScript para pomodoro',
        'Rotina Di√°ria' => 'Card de rotina no dashboard',
        'Pomodoro Timer' => 'Card de pomodoro no dashboard',
        'Organiza√ß√£o por Hor√°rio' => 'Card de organiza√ß√£o por hor√°rio'
    ];
    
    foreach ($checks as $termo => $descricao) {
        if (strpos($content, $termo) !== false) {
            echo "‚úÖ <strong>$descricao</strong> - Integrado<br>";
        } else {
            echo "‚ùå <strong>$descricao</strong> - N√ÉO integrado<br>";
        }
    }
} else {
    echo "‚ùå <strong>dashboard.php</strong> - Arquivo n√£o encontrado<br>";
}

echo "<br>";

// 4. Verificar menu
echo "<h2>4. Verifica√ß√£o do Menu</h2>";

if (file_exists('templates/header.php')) {
    $content = file_get_contents('templates/header.php');
    
    $menu_checks = [
        'rotina_diaria.php' => 'Link para rotina di√°ria',
        'pomodoro.php' => 'Link para pomodoro',
        'automatizacao_horario.php' => 'Link para organiza√ß√£o por hor√°rio',
        'Rotina Di√°ria' => 'Nome do menu rotina',
        'Pomodoro Timer' => 'Nome do menu pomodoro',
        'Organiza√ß√£o por Hor√°rio' => 'Nome do menu organiza√ß√£o'
    ];
    
    foreach ($menu_checks as $termo => $descricao) {
        if (strpos($content, $termo) !== false) {
            echo "‚úÖ <strong>$descricao</strong> - No menu<br>";
        } else {
            echo "‚ùå <strong>$descricao</strong> - N√ÉO no menu<br>";
        }
    }
} else {
    echo "‚ùå <strong>templates/header.php</strong> - Arquivo n√£o encontrado<br>";
}

echo "<br>";

// 5. Instru√ß√µes de teste
echo "<h2>5. Instru√ß√µes para Teste Manual</h2>";
echo "<div style='background: #e7f3ff; padding: 1rem; border-radius: 8px; margin: 1rem 0;'>";
echo "<h4>üöÄ Como testar os novos sistemas:</h4>";
echo "<ol>";
echo "<li><strong>Primeiro:</strong> Execute <a href='criar_tabelas_rotina_pomodoro.php' target='_blank'>criar_tabelas_rotina_pomodoro.php</a> para criar as tabelas</li>";
echo "<li><strong>Dashboard:</strong> Acesse <a href='dashboard.php' target='_blank'>dashboard.php</a> e verifique os novos cards</li>";
echo "<li><strong>Rotina Di√°ria:</strong> Acesse <a href='rotina_diaria.php' target='_blank'>rotina_diaria.php</a> e teste os h√°bitos</li>";
echo "<li><strong>Pomodoro:</strong> Acesse <a href='pomodoro.php' target='_blank'>pomodoro.php</a> e teste o timer</li>";
echo "<li><strong>Organiza√ß√£o:</strong> Acesse <a href='automatizacao_horario.php' target='_blank'>automatizacao_horario.php</a> e veja a organiza√ß√£o por hor√°rio</li>";
echo "</ol>";
echo "</div>";

echo "<div style='background: #d4edda; padding: 1rem; border-radius: 8px; margin: 1rem 0;'>";
echo "<h4>‚ú® Funcionalidades implementadas:</h4>";
echo "<ul>";
echo "<li><strong>1Ô∏è‚É£ Rotina Di√°ria Inteligente:</strong> H√°bitos di√°rios com progresso visual</li>";
echo "<li><strong>2Ô∏è‚É£ Pomodoro Evolu√≠do:</strong> Timer com integra√ß√£o √†s tarefas</li>";
echo "<li><strong>3Ô∏è‚É£ Automatiza√ß√£o por Hor√°rio:</strong> Organiza√ß√£o autom√°tica por per√≠odo do dia</li>";
echo "<li><strong>üé® Design Responsivo:</strong> Funciona perfeitamente no mobile e desktop</li>";
echo "<li><strong>üîó Integra√ß√£o Completa:</strong> Tudo integrado no dashboard principal</li>";
echo "</ul>";
echo "</div>";

echo "<div style='background: #fff3cd; padding: 1rem; border-radius: 8px; margin: 1rem 0;'>";
echo "<h4>‚ö†Ô∏è Pr√≥ximos passos:</h4>";
echo "<ol>";
echo "<li>Teste todas as funcionalidades em diferentes dispositivos</li>";
echo "<li>Verifique se as notifica√ß√µes est√£o funcionando</li>";
echo "<li>Teste a integra√ß√£o com tarefas existentes</li>";
echo "<li>Configure as rotinas padr√£o para seus usu√°rios</li>";
echo "</ol>";
echo "</div>";
?>
