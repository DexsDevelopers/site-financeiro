<?php
// teste_organizacao_horario.php - Teste da p√°gina de Organiza√ß√£o por Hor√°rio

echo "<h1>üß™ TESTE DA P√ÅGINA ORGANIZA√á√ÉO POR HOR√ÅRIO</h1>";
echo "<hr>";

// 1. Verificar se o arquivo existe
echo "<h2>1. Verifica√ß√£o do Arquivo</h2>";
if (file_exists('automatizacao_horario.php')) {
    echo "‚úÖ <strong>automatizacao_horario.php</strong> - Arquivo existe<br>";
    
    // Verificar tamanho do arquivo
    $size = filesize('automatizacao_horario.php');
    echo "üìä <strong>Tamanho:</strong> " . number_format($size) . " bytes<br>";
    
    // Verificar se tem conte√∫do PHP v√°lido
    $content = file_get_contents('automatizacao_horario.php');
    if (strpos($content, '<?php') !== false) {
        echo "‚úÖ <strong>Estrutura PHP:</strong> V√°lida<br>";
    } else {
        echo "‚ùå <strong>Estrutura PHP:</strong> Inv√°lida<br>";
    }
    
    // Verificar se tem require_once templates/header.php
    if (strpos($content, "require_once 'templates/header.php'") !== false) {
        echo "‚úÖ <strong>Header:</strong> Inclu√≠do corretamente<br>";
    } else {
        echo "‚ùå <strong>Header:</strong> N√ÉO inclu√≠do<br>";
    }
    
    // Verificar se tem footer
    if (strpos($content, "require_once 'templates/footer.php'") !== false) {
        echo "‚úÖ <strong>Footer:</strong> Inclu√≠do corretamente<br>";
    } else {
        echo "‚ùå <strong>Footer:</strong> N√ÉO inclu√≠do<br>";
    }
    
} else {
    echo "‚ùå <strong>automatizacao_horario.php</strong> - Arquivo N√ÉO existe<br>";
}

echo "<br>";

// 2. Verificar depend√™ncias
echo "<h2>2. Verifica√ß√£o de Depend√™ncias</h2>";

$dependencias = [
    'templates/header.php' => 'Header template',
    'templates/footer.php' => 'Footer template',
    'includes/db_connect.php' => 'Conex√£o com banco',
    'concluir_tarefa.php' => 'Script de conclus√£o de tarefas'
];

foreach ($dependencias as $arquivo => $descricao) {
    if (file_exists($arquivo)) {
        echo "‚úÖ <strong>$descricao</strong> - Existe<br>";
    } else {
        echo "‚ùå <strong>$descricao</strong> - N√ÉO existe<br>";
    }
}

echo "<br>";

// 3. Verificar configura√ß√£o do menu
echo "<h2>3. Verifica√ß√£o do Menu</h2>";

if (file_exists('includes/load_menu_config.php')) {
    $menu_content = file_get_contents('includes/load_menu_config.php');
    
    if (strpos($menu_content, 'automatizacao_horario.php') !== false) {
        echo "‚úÖ <strong>Menu configurado:</strong> automatizacao_horario.php est√° no menu<br>";
    } else {
        echo "‚ùå <strong>Menu configurado:</strong> automatizacao_horario.php N√ÉO est√° no menu<br>";
    }
    
    if (strpos($menu_content, 'Organiza√ß√£o por Hor√°rio') !== false) {
        echo "‚úÖ <strong>Nome da p√°gina:</strong> 'Organiza√ß√£o por Hor√°rio' configurado<br>";
    } else {
        echo "‚ùå <strong>Nome da p√°gina:</strong> 'Organiza√ß√£o por Hor√°rio' N√ÉO configurado<br>";
    }
    
} else {
    echo "‚ùå <strong>includes/load_menu_config.php</strong> - Arquivo n√£o encontrado<br>";
}

echo "<br>";

// 4. Teste de acesso direto
echo "<h2>4. Teste de Acesso Direto</h2>";

$url_teste = "http://" . $_SERVER['HTTP_HOST'] . dirname($_SERVER['REQUEST_URI']) . "/automatizacao_horario.php";
echo "üîó <strong>URL de teste:</strong> <a href='$url_teste' target='_blank'>$url_teste</a><br>";

// Verificar se a URL responde
$headers = @get_headers($url_teste);
if ($headers && strpos($headers[0], '200') !== false) {
    echo "‚úÖ <strong>Resposta HTTP:</strong> 200 OK<br>";
} else {
    echo "‚ùå <strong>Resposta HTTP:</strong> Erro ou n√£o acess√≠vel<br>";
    if ($headers) {
        echo "üìã <strong>Headers:</strong> " . $headers[0] . "<br>";
    }
}

echo "<br>";

// 5. Verificar estrutura da tabela tarefas
echo "<h2>5. Verifica√ß√£o da Estrutura do Banco</h2>";

try {
    require_once 'includes/db_connect.php';
    
    // Verificar se a tabela tarefas existe
    $stmt = $pdo->query("SHOW TABLES LIKE 'tarefas'");
    if ($stmt->fetch()) {
        echo "‚úÖ <strong>Tabela tarefas:</strong> Existe<br>";
        
        // Verificar colunas necess√°rias
        $stmt = $pdo->query("DESCRIBE tarefas");
        $colunas = $stmt->fetchAll(PDO::FETCH_COLUMN);
        
        $colunas_necessarias = ['id', 'descricao', 'prioridade', 'status', 'hora_inicio', 'data_criacao', 'id_usuario'];
        foreach ($colunas_necessarias as $coluna) {
            if (in_array($coluna, $colunas)) {
                echo "‚úÖ <strong>Coluna $coluna:</strong> Existe<br>";
            } else {
                echo "‚ùå <strong>Coluna $coluna:</strong> N√ÉO existe<br>";
            }
        }
        
    } else {
        echo "‚ùå <strong>Tabela tarefas:</strong> N√ÉO existe<br>";
    }
    
} catch (Exception $e) {
    echo "‚ùå <strong>Erro de conex√£o:</strong> " . $e->getMessage() . "<br>";
}

echo "<br>";

// 6. Instru√ß√µes para corre√ß√£o
echo "<h2>6. Instru√ß√µes para Corre√ß√£o</h2>";
echo "<p>Se a p√°gina n√£o estiver funcionando, siga estes passos:</p>";
echo "<ol>";
echo "<li><strong>Verifique se est√° logado:</strong> A p√°gina requer autentica√ß√£o</li>";
echo "<li><strong>Teste o acesso direto:</strong> <a href='$url_teste' target='_blank'>Clique aqui</a></li>";
echo "<li><strong>Verifique o console do navegador:</strong> Pressione F12 e veja se h√° erros JavaScript</li>";
echo "<li><strong>Verifique os logs do servidor:</strong> Procure por erros PHP</li>";
echo "<li><strong>Teste em modo inc√≥gnito:</strong> Para descartar problemas de cache</li>";
echo "</ol>";

echo "<br>";
echo "<h3>üéØ Pr√≥ximos Passos</h3>";
echo "<p>Se tudo estiver correto acima, o problema pode ser:</p>";
echo "<ul>";
echo "<li><strong>Cache do navegador:</strong> Limpe o cache e tente novamente</li>";
echo "<li><strong>Permiss√µes de arquivo:</strong> Verifique se o arquivo tem permiss√£o de leitura</li>";
echo "<li><strong>Configura√ß√£o do servidor:</strong> Verifique se o PHP est√° funcionando</li>";
echo "<li><strong>Erro de sintaxe:</strong> Verifique se h√° erros PHP no arquivo</li>";
echo "</ul>";

?>
